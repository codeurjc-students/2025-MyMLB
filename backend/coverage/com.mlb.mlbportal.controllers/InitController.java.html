<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InitController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MLBPortal</a> &gt; <a href="index.source.html" class="el_package">com.mlb.mlbportal.controllers</a> &gt; <span class="el_source">InitController.java</span></div><h1>InitController.java</h1><pre class="source lang-java linenums">package com.mlb.mlbportal.controllers;

import java.io.IOException;
import java.io.InputStream;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Controller;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.mlb.mlbportal.dto.team.TeamInitDTO;
import com.mlb.mlbportal.handler.notFound.TeamNotFoundException;
import com.mlb.mlbportal.models.Match;
import com.mlb.mlbportal.models.Team;
import com.mlb.mlbportal.models.UserEntity;
import com.mlb.mlbportal.models.enums.Division;
import com.mlb.mlbportal.models.enums.League;
import com.mlb.mlbportal.repositories.MatchRepository;
import com.mlb.mlbportal.repositories.TeamRepository;
import com.mlb.mlbportal.repositories.UserRepository;

import jakarta.annotation.PostConstruct;

@Controller
public class InitController {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    private final TeamRepository teamRepository;
    private final MatchRepository matchRepository;

    @Value(&quot;${init.user1.password}&quot;)
    private String fonssiPassword;

    @Value(&quot;${init.user2.password}&quot;)
    private String arminPassword;

<span class="fc" id="L42">    public InitController(UserRepository userRepository, PasswordEncoder passsEncoder, TeamRepository teamRepo, MatchRepository matchRepo) {</span>
<span class="fc" id="L43">        this.userRepository = userRepository;</span>
<span class="fc" id="L44">        this.passwordEncoder = passsEncoder;</span>

<span class="fc" id="L46">        this.teamRepository = teamRepo;</span>
<span class="fc" id="L47">        this.matchRepository = matchRepo;</span>
<span class="fc" id="L48">    }</span>

    @PostConstruct
    public void init() {
<span class="fc" id="L52">        this.createAdmins();</span>
<span class="fc" id="L53">        this.setUpTeams();</span>
<span class="fc" id="L54">        this.setUpMatches();</span>
<span class="fc" id="L55">    }</span>

    private void createAdmins() {
<span class="fc" id="L58">        UserEntity fonssiUser = new UserEntity(&quot;fonssitorodriguezgutt@gmail.com&quot;, &quot;fonssi29&quot;,</span>
<span class="fc" id="L59">                this.passwordEncoder.encode(this.fonssiPassword));</span>
<span class="fc" id="L60">        UserEntity arminUser = new UserEntity(&quot;armin@gmail.com&quot;, &quot;armiin13&quot;,</span>
<span class="fc" id="L61">                this.passwordEncoder.encode(this.arminPassword));</span>

<span class="fc" id="L63">        fonssiUser.getRoles().add(&quot;ADMIN&quot;);</span>
<span class="fc" id="L64">        arminUser.getRoles().add(&quot;ADMIN&quot;);</span>

<span class="fc" id="L66">        this.userRepository.save(fonssiUser);</span>
<span class="fc" id="L67">        this.userRepository.save(arminUser);</span>
<span class="fc" id="L68">    }</span>

    private void setUpTeams() {
<span class="fc" id="L71">        ObjectMapper mapper = new ObjectMapper();</span>
<span class="fc" id="L72">        try (InputStream input = getClass().getResourceAsStream(&quot;/data/teams-2025.json&quot;)) {</span>
<span class="fc" id="L73">            TeamInitDTO[] teamDtos = mapper.readValue(input, TeamInitDTO[].class);</span>

<span class="fc" id="L75">            List&lt;Team&gt; teams = Arrays.stream(teamDtos)</span>
<span class="fc" id="L76">                    .map(dto -&gt; {</span>
<span class="fc" id="L77">                        League league = League.valueOf(dto.league().toUpperCase());</span>
<span class="fc" id="L78">                        Division division = Division.valueOf(dto.division().toUpperCase());</span>
<span class="fc" id="L79">                        String logo = dto.abbreviation() + &quot;.png&quot;;</span>

<span class="fc" id="L81">                        Team team = new Team(dto.name(), dto.abbreviation(), dto.wins(), dto.losses(), league, division,</span>
                                logo);
<span class="fc" id="L83">                        int totalGames = dto.wins() + dto.losses();</span>
<span class="fc" id="L84">                        team.setTotalGames(totalGames);</span>
<span class="fc" id="L85">                        team.setPct((double) dto.wins() / totalGames);</span>
<span class="fc" id="L86">                        team.setGamesBehind(0);</span>
<span class="fc" id="L87">                        team.setLastTen(&quot;0-0&quot;);</span>

<span class="fc" id="L89">                        return team;</span>
                    })
<span class="fc" id="L91">                    .collect(Collectors.toList());</span>

<span class="fc" id="L93">            this.teamRepository.saveAll(teams);</span>
<span class="nc" id="L94">        } catch (IOException e) {</span>
<span class="nc" id="L95">            throw new RuntimeException(&quot;Error loading team data from JSON&quot;, e);</span>
<span class="fc" id="L96">        }</span>
<span class="fc" id="L97">    }</span>

    private void setUpMatches() {
<span class="fc" id="L100">        Team yankees = this.teamRepository.findByName(&quot;New York Yankees&quot;).orElseThrow(TeamNotFoundException::new);</span>
<span class="fc" id="L101">        Team toronto = this.teamRepository.findByName(&quot;Toronto Blue Jays&quot;).orElseThrow(TeamNotFoundException::new);</span>
<span class="fc" id="L102">        Team dodgers = this.teamRepository.findByName(&quot;Los Angeles Dodgers&quot;).orElseThrow(TeamNotFoundException::new);</span>
<span class="fc" id="L103">        Team detroit = this.teamRepository.findByName(&quot;Detroit Tigers&quot;).orElseThrow(TeamNotFoundException::new);</span>

<span class="fc" id="L105">         List&lt;Match&gt; matches = List.of(</span>
            new Match(yankees, toronto, 5, 3),
            new Match(yankees, toronto, 2, 6),
            new Match(yankees, toronto, 4, 1),

            new Match(dodgers, yankees, 5, 2),
            new Match(dodgers, yankees, 0, 2),
            new Match(dodgers, yankees, 3, 4),

            new Match(toronto, detroit, 0, 7),
            new Match(toronto, detroit, 1, 2),
            new Match(toronto, detroit, 5, 8),

            new Match(detroit, yankees, 4, 6),
            new Match(detroit, yankees, 4, 0),
            new Match(detroit, yankees, 7, 4),

            new Match(toronto, yankees, 7, 4),
            new Match(toronto, yankees, 0, 4),
            new Match(toronto, yankees, 2, 6),

            new Match(dodgers, detroit, 3, 4),
            new Match(dodgers, detroit, 6, 9),
            new Match(dodgers, detroit, 0, 7),

            new Match(toronto, dodgers, 0, 7),
            new Match(toronto, dodgers, 5, 2),
            new Match(toronto, dodgers, 4, 2)
        );
<span class="fc" id="L134">        this.matchRepository.saveAll(matches.reversed());</span>

<span class="fc" id="L136">        yankees.getHomeMatches().addAll(matches.stream().filter(m -&gt; m.getHomeTeam().equals(yankees)).toList());</span>
<span class="fc" id="L137">        yankees.getAwayMatches().addAll(matches.stream().filter(m -&gt; m.getAwayTeam().equals(yankees)).toList());</span>

<span class="fc" id="L139">        toronto.getHomeMatches().addAll(matches.stream().filter(m -&gt; m.getHomeTeam().equals(toronto)).toList());</span>
<span class="fc" id="L140">        toronto.getAwayMatches().addAll(matches.stream().filter(m -&gt; m.getAwayTeam().equals(toronto)).toList());</span>

<span class="fc" id="L142">        detroit.getHomeMatches().addAll(matches.stream().filter(m -&gt; m.getHomeTeam().equals(detroit)).toList());</span>
<span class="fc" id="L143">        detroit.getAwayMatches().addAll(matches.stream().filter(m -&gt; m.getAwayTeam().equals(detroit)).toList());</span>

<span class="fc" id="L145">        dodgers.getHomeMatches().addAll(matches.stream().filter(m -&gt; m.getHomeTeam().equals(dodgers)).toList());</span>
<span class="fc" id="L146">        dodgers.getAwayMatches().addAll(matches.stream().filter(m -&gt; m.getAwayTeam().equals(dodgers)).toList());</span>

<span class="fc" id="L148">        this.teamRepository.save(yankees);</span>
<span class="fc" id="L149">        this.teamRepository.save(toronto);</span>
<span class="fc" id="L150">        this.teamRepository.save(detroit);</span>
<span class="fc" id="L151">        this.teamRepository.save(dodgers);</span>
<span class="fc" id="L152">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>