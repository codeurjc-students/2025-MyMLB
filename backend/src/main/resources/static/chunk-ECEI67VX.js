import{a as H,b as F}from"./chunk-VIWRQYVU.js";import{a as z}from"./chunk-6SSBI4VU.js";import{e as N}from"./chunk-VWWJC7N5.js";import{a as J}from"./chunk-7HRPLCQ4.js";import{a as U,c as j,e as O,r as W,t as Y}from"./chunk-732WY32V.js";import{$a as n,C as A,Ga as y,La as R,S as C,Ua as h,Wa as _,X as s,Y as c,Z as b,_ as D,_a as d,ab as r,bb as v,cb as x,db as P,eb as S,ec as B,fb as w,gb as m,hb as q,ib as f,mb as M,nc as G,pb as p,rb as E,sa as L,tb as V,ub as T,va as a,vb as I}from"./chunk-W3BZSQCG.js";function $(o,i){o&1&&(b(),x(0,"svg",2),S(1,"path",4),P())}function ee(o,i){o&1&&(b(),x(0,"svg",2),S(1,"path",5),P())}var k=class o{content;buttonType;confirm=new R;handleConfirm(){this.confirm.emit()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["app-profile-buttons"]],inputs:{content:"content",buttonType:"buttonType"},outputs:{confirm:"confirm"},decls:6,vars:2,consts:[[1,"app-red-buttons","group",3,"click"],[1,"app-button-bright"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"relative","z-10","w-5","h-5","transition-transform","duration-300","group-hover:rotate-12"],[1,"app-button-texts"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["stroke-linecap","round","stroke-linejoin","round","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"]],template:function(e,t){e&1&&(x(0,"button",0),q("click",function(){return t.handleConfirm()}),S(1,"span",1),h(2,$,2,0,":svg:svg",2)(3,ee,2,0,":svg:svg",2),x(4,"span",3),p(5),P()()),e&2&&(a(2),_(t.buttonType==="delete"?2:3),a(3),E(" ",t.content))},encapsulation:2})};function te(o,i){if(o&1){let e=w();n(0,"button",33),m("click",function(){s(e);let l=f();return c(l.removeProfilePicture())}),b(),n(1,"svg",34),v(2,"path",35),r()()}}function ie(o,i){if(o&1){let e=w();n(0,"app-remove-confirmation-modal",36),m("confirm",function(){s(e);let l=f();return c(l.confirm())})("cancel",function(){s(e);let l=f();return c(l.cancel())}),r()}if(o&2){let e=f();d("title",e.activeAction==="logout"?"Are you sure you want to log out?":"Are you sure you want to delete your account?")("contentMessage",e.activeAction==="logout"?"You will be signed out of your account and will need to log in again to continue.":"Your account will be deleted from the system and this is an irreversible change.")("buttonContent",e.activeAction==="logout"?"Yes, Logout":"Yes, Delete")("isDelete",e.activeAction==="delete")}}function ne(o,i){if(o&1){let e=w();n(0,"app-success-modal",37),m("continue",function(){s(e);let l=f();return c(l.sucess=!1)}),r()}if(o&2){let e=f();d("message",e.successMessage)}}function re(o,i){if(o&1){let e=w();n(0,"app-error-modal",38),m("cancel",function(){s(e);let l=f();return c(l.error=!1)}),r()}if(o&2){let e=f();d("title",e.errorMessage)}}function oe(o,i){o&1&&v(0,"app-loading-modal",31),o&2&&d("message","Uploading the image...")}var K=class o{authService=C(H);router=C(N);userService=C(F);username="";error=!1;errorMessage="";activeAction=null;editRequest={};pictureSrc=null;emailInput="";passwordInput="";currentEmail="";oldEmail="";notificationsEnabled=!0;sucess=!1;successMessage="";loading=!1;ngOnInit(){this.authService.getActiveUser().subscribe({next:i=>{this.username=i.username},error:()=>{this.error=!0,this.errorMessage="Unexpected error while retrieving the user"}}),this.retrieveProfileData()}retrieveProfileData(){this.userService.getUserProfile().subscribe({next:i=>{this.currentEmail=i.email,this.oldEmail=i.email,this.pictureSrc=i.picture,this.notificationsEnabled=i.enableNotifications??!0},error:i=>{this.error=!0,this.errorMessage="Unexpected error while retrieving the profile data"}})}openModal(i){this.activeAction=i}cancel(){this.activeAction=null}confirm(){this.activeAction==="logout"&&this.authService.logoutUser().subscribe(()=>this.router.navigate(["/"])),this.activeAction==="delete"&&this.authService.deleteAccount().subscribe(()=>this.router.navigate(["/"])),this.activeAction=null}prepareRequest(){this.emailInput!==""&&(this.editRequest.email=this.emailInput),this.passwordInput!==""&&(this.editRequest.password=this.passwordInput),this.editRequest.enableNotifications=this.notificationsEnabled}editProfile(){this.prepareRequest(),this.userService.editProfile(this.editRequest).subscribe({next:i=>{this.sucess=!0,this.successMessage="Profile Updated!",this.currentEmail=this.editRequest.email===null||this.editRequest.email===void 0?this.oldEmail:this.editRequest.email,this.emailInput="",this.passwordInput=""},error:i=>{this.error=!0,this.errorMessage="Invalid format for some of the fields entered"}})}handleProfilePicture(i){let e=i.target;if(e.files&&e.files.length>0){let t=e.files[0];if(t.type!=="image/webp"){this.error=!0,this.errorMessage="Only .webp images are allowed",this.loading=!1,e.value="";return}this.changeProfilePicture(t),e.value=""}}getPictureUrl(){return this.pictureSrc===null?"assets/account-avatar.png":this.pictureSrc.url}changeProfilePicture(i){if(i.type!=="image/webp"){this.error=!0,this.errorMessage="Only .webp images are allowed";return}this.loading=!0,this.userService.editProfilePicture(i).pipe(A(()=>this.loading=!1)).subscribe({next:e=>{this.sucess=!0,this.successMessage="Picture uploaded successfully",this.pictureSrc=e,this.userService.setProfilePicture(e.url)},error:e=>{this.error=!0,this.errorMessage="An error occurred trying to upload the picture"}})}removeProfilePicture(){this.userService.deleteProfilePicture().subscribe({next:i=>{this.sucess=!0,this.successMessage="Profile Picture Successfully Deleted",this.pictureSrc=null,this.userService.setProfilePicture("")},error:i=>{this.error=!0,this.errorMessage="An error ocurr while deleting the profile picture"}})}toggleNotifications(){this.notificationsEnabled=!this.notificationsEnabled}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=y({type:o,selectors:[["app-profile"]],decls:47,vars:15,consts:[["fileInput",""],[1,"min-h-screen","app-background","flex","flex-col","items-center","justify-center","gap-12","p-6"],[1,"flex","flex-col","items-center","gap-4"],[1,"relative","group","w-36","h-36"],["alt","Profile picture",1,"w-36","h-36","rounded-full","object-cover","shadow-xl","ring-4","ring-white","dark:ring-gray-700","cursor-pointer","hover:opacity-90","transition",3,"click","src"],["type","button",1,"absolute","bottom-2","right-2","z-10","bg-blue-600","hover:bg-blue-700","text-white","p-2","rounded-full","shadow-md","transition-all","active:scale-95",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5",2,"pointer-events","none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12V4m0 0l-3 3m3-3l3 3"],["type","button",1,"absolute","top-2","right-2","cursor-pointer","bg-red-600","hover:bg-red-700","text-white","p-2","rounded-full","shadow-md","opacity-90","group-hover:opacity-100","transition"],["type","file","accept","image/webp",1,"hidden",3,"change"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold"],[1,"text-4xl","font-bold","text-gray-900","dark:text-gray-100","tracking-tight"],[1,"bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"w-full","max-w-lg","bg-white","dark:bg-gray-800","rounded-3xl","shadow-xl","p-8","flex","flex-col","gap-8"],[1,"text-2xl","font-semibold","text-center","bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"flex","flex-col","gap-2"],[1,"text-gray-700","dark:text-gray-300","font-medium"],["type","email",1,"text-inputs",3,"ngModelChange","placeholder","ngModel"],["type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 (new password)",1,"text-inputs",3,"ngModelChange","ngModel"],[1,"w-full","app-success-button","group",3,"click"],[1,"app-button-bright"],[1,"app-button-texts"],[1,"flex","items-center","justify-between","bg-gray-100","dark:bg-gray-700","px-4","py-3","rounded-2xl","shadow-inner"],[1,"text-gray-700","dark:text-gray-300","font-medium","text-lg"],[1,"inline-flex","items-center","cursor-pointer"],["type","checkbox",1,"sr-only","peer",3,"change","checked"],[1,"relative","w-12","h-7","bg-gray-300","dark:bg-gray-600","rounded-full","peer","peer-focus:ring-4","peer-focus:ring-blue-300","dark:peer-focus:ring-blue-800","peer-checked:bg-blue-600","transition","peer-checked:after:translate-x-full","rtl:peer-checked:after:-translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:start-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-6","after:w-6","after:transition-all","dark:border-gray-500"],[1,"w-full","max-w-lg","flex","flex-row","items-center","justify-between","px-2"],[3,"confirm","content","buttonType"],[3,"title","contentMessage","buttonContent","isDelete"],[3,"message"],[3,"title"],["type","button",1,"absolute","top-2","right-2","cursor-pointer","bg-red-600","hover:bg-red-700","text-white","p-2","rounded-full","shadow-md","opacity-90","group-hover:opacity-100","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[3,"confirm","cancel","title","contentMessage","buttonContent","isDelete"],[3,"continue","message"],[3,"cancel","title"]],template:function(e,t){if(e&1){let l=w();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"img",4),m("click",function(){s(l);let u=M(9);return c(u.click())}),r(),n(4,"button",5),m("click",function(u){s(l);let Q=M(9);return u.stopPropagation(),c(Q.click())}),b(),n(5,"svg",6),v(6,"path",7),r()(),h(7,te,3,0,"button",8),r(),D(),n(8,"input",9,0),m("change",function(u){return s(l),c(t.handleProfilePicture(u))}),r(),n(10,"p",10),p(11," Only "),n(12,"span",11),p(13,".webp"),r(),p(14," files are allowed "),r(),n(15,"h1",12),p(16," Welcome, "),n(17,"span",13),p(18),r()()(),n(19,"div",14)(20,"h2",15),p(21," Profile Information "),r(),n(22,"div",16)(23,"label",17),p(24,"Email"),r(),n(25,"input",18),I("ngModelChange",function(u){return s(l),T(t.emailInput,u)||(t.emailInput=u),c(u)}),r()(),n(26,"div",16)(27,"label",17),p(28,"Password"),r(),n(29,"input",19),I("ngModelChange",function(u){return s(l),T(t.passwordInput,u)||(t.passwordInput=u),c(u)}),r()(),n(30,"button",20),m("click",function(){return s(l),c(t.editProfile())}),v(31,"span",21),n(32,"span",22),p(33,"Save Changes"),r()(),n(34,"div",23)(35,"span",24),p(36," Notifications "),r(),n(37,"label",25)(38,"input",26),m("change",function(){return s(l),c(t.toggleNotifications())}),r(),v(39,"div",27),r()()(),n(40,"div",28)(41,"app-profile-buttons",29),m("confirm",function(){return s(l),c(t.openModal("logout"))}),r(),n(42,"app-profile-buttons",29),m("confirm",function(){return s(l),c(t.openModal("delete"))}),r()(),h(43,ie,1,4,"app-remove-confirmation-modal",30),h(44,ne,1,1,"app-success-modal",31),h(45,re,1,1,"app-error-modal",32),h(46,oe,1,1,"app-loading-modal",31),r()}e&2&&(a(3),d("src",t.getPictureUrl(),L),a(4),_(t.pictureSrc!==null?7:-1),a(11),E(" ",t.username," "),a(7),d("placeholder",t.currentEmail),V("ngModel",t.emailInput),a(4),V("ngModel",t.passwordInput),a(9),d("checked",t.notificationsEnabled),a(3),d("content","Logout")("buttonType","logout"),a(),d("content","Delete Account")("buttonType","delete"),a(),_(t.activeAction?43:-1),a(),_(t.sucess?44:-1),a(),_(t.error?45:-1),a(),_(t.loading?46:-1))},dependencies:[B,W,U,j,O,z,k,G,Y,J],encapsulation:2})};export{K as ProfileComponent};
