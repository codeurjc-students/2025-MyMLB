import{a as N,b as F}from"./chunk-UI7KFSXJ.js";import{a as J}from"./chunk-P6FBTWPZ.js";import{a as z}from"./chunk-QHRVWTMD.js";import{a as Y}from"./chunk-E4CUHPIT.js";import{a as j,c as O,e as W,q as H}from"./chunk-EVNGVB2L.js";import{a as G}from"./chunk-6DCJJQNU.js";import{$ as o,G as L,I as a,L as P,P as R,U as g,Ua as q,W as h,_ as d,aa as r,ba as w,bb as U,ca as C,da as y,ea as S,fa as v,ga as m,ha as B,ia as f,m as A,ma as k,pa as p,ra as E,ta as V,ua as T,v as x,va as I,w as s,x as c,y as b,z as D}from"./chunk-RUM4B2H2.js";function $(n,i){n&1&&(b(),C(0,"svg",2),S(1,"path",4),y())}function ee(n,i){n&1&&(b(),C(0,"svg",2),S(1,"path",5),y())}var M=class n{content;buttonType;confirm=new R;handleConfirm(){this.confirm.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-profile-buttons"]],inputs:{content:"content",buttonType:"buttonType"},outputs:{confirm:"confirm"},decls:6,vars:2,consts:[[1,"app-red-buttons","group",3,"click"],[1,"app-button-bright"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","currentColor",1,"relative","z-10","w-5","h-5","transition-transform","duration-300","group-hover:rotate-12"],[1,"app-button-texts"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],["stroke-linecap","round","stroke-linejoin","round","d","M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h6a2 2 0 012 2v1"]],template:function(e,t){e&1&&(C(0,"button",0),B("click",function(){return t.handleConfirm()}),S(1,"span",1),g(2,$,2,0,":svg:svg",2)(3,ee,2,0,":svg:svg",2),C(4,"span",3),p(5),y()()),e&2&&(a(2),h(t.buttonType==="delete"?2:3),a(3),E(" ",t.content))},encapsulation:2})};function te(n,i){if(n&1){let e=v();o(0,"button",28),m("click",function(){s(e);let l=f();return c(l.removeProfilePicture())}),b(),o(1,"svg",29),w(2,"path",30),r()()}}function ie(n,i){if(n&1){let e=v();o(0,"app-remove-confirmation-modal",31),m("confirm",function(){s(e);let l=f();return c(l.confirm())})("cancel",function(){s(e);let l=f();return c(l.cancel())}),r()}if(n&2){let e=f();d("title",e.activeAction==="logout"?"Are you sure you want to log out?":"Are you sure you want to delete your account?")("contentMessage",e.activeAction==="logout"?"You will be signed out of your account and will need to log in again to continue.":"Your account will be deleted from the system and this is an irreversible change.")("buttonContent",e.activeAction==="logout"?"Yes, Logout":"Yes, Delete")("isDelete",e.activeAction==="delete")}}function ne(n,i){if(n&1){let e=v();o(0,"app-success-modal",32),m("continue",function(){s(e);let l=f();return c(l.sucess=!1)}),r()}if(n&2){let e=f();d("message",e.successMessage)}}function oe(n,i){if(n&1){let e=v();o(0,"app-error-modal",33),m("cancel",function(){s(e);let l=f();return c(l.error=!1)}),r()}if(n&2){let e=f();d("title",e.errorMessage)}}function re(n,i){n&1&&w(0,"app-loading-modal",26),n&2&&d("message","Uploading the image...")}var K=class n{authService=x(N);router=x(U);userService=x(F);username="";error=!1;errorMessage="";activeAction=null;editRequest={};pictureSrc=null;emailInput="";passwordInput="";currentEmail="";oldEmail="";sucess=!1;successMessage="";loading=!1;ngOnInit(){this.authService.getActiveUser().subscribe({next:i=>{this.username=i.username},error:()=>{this.error=!0,this.errorMessage="Unexpected error while retrieving the user"}}),this.retrieveProfileData()}retrieveProfileData(){this.userService.getUserProfile().subscribe({next:i=>{this.currentEmail=i.email,this.oldEmail=i.email,this.pictureSrc=i.picture},error:i=>{this.error=!0,this.errorMessage="Unexpected error while retrieving the profile data"}})}openModal(i){this.activeAction=i}cancel(){this.activeAction=null}confirm(){this.activeAction==="logout"&&this.authService.logoutUser().subscribe(()=>this.router.navigate(["/"])),this.activeAction==="delete"&&this.authService.deleteAccount().subscribe(()=>this.router.navigate(["/"])),this.activeAction=null}prepareRequest(){this.emailInput!==""&&(this.editRequest.email=this.emailInput),this.passwordInput!==""&&(this.editRequest.password=this.passwordInput)}editProfile(){this.prepareRequest(),this.userService.editProfile(this.editRequest).subscribe({next:i=>{this.sucess=!0,this.successMessage="Profile Updated!",this.currentEmail=this.editRequest.email===null||this.editRequest.email===void 0?this.oldEmail:this.editRequest.email,this.emailInput="",this.passwordInput=""},error:i=>{this.error=!0,this.errorMessage="Invalid format for some of the fields entered"}})}handleProfilePicture(i){let e=i.target;if(e.files&&e.files.length>0){let t=e.files[0];if(t.type!=="image/webp"){this.error=!0,this.errorMessage="Only .webp images are allowed",this.loading=!1,e.value="";return}this.changeProfilePicture(t),e.value=""}}getPictureUrl(){return this.pictureSrc===null?"assets/account-avatar.png":this.pictureSrc.url}changeProfilePicture(i){if(i.type!=="image/webp"){this.error=!0,this.errorMessage="Only .webp images are allowed";return}this.loading=!0,this.userService.editProfilePicture(i).pipe(A(()=>this.loading=!1)).subscribe({next:e=>{this.sucess=!0,this.successMessage="Picture uploaded successfully",this.pictureSrc=e,this.userService.setProfilePicture(e.url)},error:e=>{this.error=!0,this.errorMessage="An error occurred trying to upload the picture"}})}removeProfilePicture(){this.userService.deleteProfilePicture().subscribe({next:i=>{this.sucess=!0,this.successMessage="Profile Picture Successfully Deleted",this.pictureSrc=null,this.userService.setProfilePicture("")},error:i=>{this.error=!0,this.errorMessage="An error ocurr while deleting the profile picture"}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=P({type:n,selectors:[["app-profile"]],decls:41,vars:14,consts:[["fileInput",""],[1,"min-h-screen","app-background","flex","flex-col","items-center","justify-center","gap-12","p-6"],[1,"flex","flex-col","items-center","gap-4"],[1,"relative","group","w-36","h-36"],["alt","Profile picture",1,"w-36","h-36","rounded-full","object-cover","shadow-xl","ring-4","ring-white","dark:ring-gray-700","cursor-pointer","hover:opacity-90","transition",3,"click","src"],["type","button",1,"absolute","bottom-2","right-2","z-10","bg-blue-600","hover:bg-blue-700","text-white","p-2","rounded-full","shadow-md","transition-all","active:scale-95",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5",2,"pointer-events","none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12V4m0 0l-3 3m3-3l3 3"],["type","button",1,"absolute","top-2","right-2","cursor-pointer","bg-red-600","hover:bg-red-700","text-white","p-2","rounded-full","shadow-md","opacity-90","group-hover:opacity-100","transition"],["type","file","accept","image/webp",1,"hidden",3,"change"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold"],[1,"text-4xl","font-bold","text-gray-900","dark:text-gray-100","tracking-tight"],[1,"bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"w-full","max-w-lg","bg-white","dark:bg-gray-800","rounded-3xl","shadow-xl","p-8","flex","flex-col","gap-8"],[1,"text-2xl","font-semibold","text-center","bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"flex","flex-col","gap-2"],[1,"text-gray-700","dark:text-gray-300","font-medium"],["type","email",1,"text-inputs",3,"ngModelChange","placeholder","ngModel"],["type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 (new password)",1,"text-inputs",3,"ngModelChange","ngModel"],[1,"w-full","app-success-button","group",3,"click"],[1,"app-button-bright"],[1,"app-button-texts"],[1,"w-full","max-w-lg","flex","flex-row","items-center","justify-between","px-2"],[3,"confirm","content","buttonType"],[3,"title","contentMessage","buttonContent","isDelete"],[3,"message"],[3,"title"],["type","button",1,"absolute","top-2","right-2","cursor-pointer","bg-red-600","hover:bg-red-700","text-white","p-2","rounded-full","shadow-md","opacity-90","group-hover:opacity-100","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"],[3,"confirm","cancel","title","contentMessage","buttonContent","isDelete"],[3,"continue","message"],[3,"cancel","title"]],template:function(e,t){if(e&1){let l=v();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"img",4),m("click",function(){s(l);let u=k(9);return c(u.click())}),r(),o(4,"button",5),m("click",function(u){s(l);let Q=k(9);return u.stopPropagation(),c(Q.click())}),b(),o(5,"svg",6),w(6,"path",7),r()(),g(7,te,3,0,"button",8),r(),D(),o(8,"input",9,0),m("change",function(u){return s(l),c(t.handleProfilePicture(u))}),r(),o(10,"p",10),p(11," Only "),o(12,"span",11),p(13,".webp"),r(),p(14," files are allowed "),r(),o(15,"h1",12),p(16," Welcome, "),o(17,"span",13),p(18),r()()(),o(19,"div",14)(20,"h2",15),p(21," Profile Information "),r(),o(22,"div",16)(23,"label",17),p(24,"Email"),r(),o(25,"input",18),I("ngModelChange",function(u){return s(l),T(t.emailInput,u)||(t.emailInput=u),c(u)}),r()(),o(26,"div",16)(27,"label",17),p(28,"Password"),r(),o(29,"input",19),I("ngModelChange",function(u){return s(l),T(t.passwordInput,u)||(t.passwordInput=u),c(u)}),r()(),o(30,"button",20),m("click",function(){return s(l),c(t.editProfile())}),w(31,"span",21),o(32,"span",22),p(33,"Save Changes"),r()()(),o(34,"div",23)(35,"app-profile-buttons",24),m("confirm",function(){return s(l),c(t.openModal("logout"))}),r(),o(36,"app-profile-buttons",24),m("confirm",function(){return s(l),c(t.openModal("delete"))}),r()(),g(37,ie,1,4,"app-remove-confirmation-modal",25),g(38,ne,1,1,"app-success-modal",26),g(39,oe,1,1,"app-error-modal",27),g(40,re,1,1,"app-loading-modal",26),r()}e&2&&(a(3),d("src",t.getPictureUrl(),L),a(4),h(t.pictureSrc!==null?7:-1),a(11),E(" ",t.username," "),a(7),d("placeholder",t.currentEmail),V("ngModel",t.emailInput),a(4),V("ngModel",t.passwordInput),a(6),d("content","Logout")("buttonType","logout"),a(),d("content","Delete Account")("buttonType","delete"),a(),h(t.activeAction?37:-1),a(),h(t.sucess?38:-1),a(),h(t.error?39:-1),a(),h(t.loading?40:-1))},dependencies:[q,H,j,O,W,z,M,G,Y,J],encapsulation:2})};export{K as ProfileComponent};
