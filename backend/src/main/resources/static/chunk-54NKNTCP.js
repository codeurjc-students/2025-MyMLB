import{Xa as n,d as i,f as o,k as u,o as t,r as p,u as a}from"./chunk-PKXEEY3P.js";var h=class s{constructor(e){this.http=e;this.fetchInitialUserStatus()}apiUrl="https://localhost:8443/api/v1/auth";defaultGuestUser={username:"",roles:["GUEST"],email:"",password:""};currentUserSubject=new i(this.defaultGuestUser);currentUser$=this.currentUserSubject.asObservable();fetchInitialUserStatus(){this.getActiveUser().pipe(t(e=>this.currentUserSubject.next(e)),u(e=>(console.warn("Failed to fetch active user status, defaulting to GUEST:",e),this.currentUserSubject.next(this.defaultGuestUser),o(this.defaultGuestUser)))).subscribe()}getActiveUser(){return this.http.get(`${this.apiUrl}/me`,{withCredentials:!0})}loginUser(e){return this.http.post(`${this.apiUrl}/login`,e,{withCredentials:!0}).pipe(t(()=>{this.getActiveUser().subscribe(r=>this.currentUserSubject.next(r))}))}registerUser(e){return this.http.post(`${this.apiUrl}/register`,e)}logoutUser(){return this.http.post(`${this.apiUrl}/logout`,{},{withCredentials:!0}).pipe(t(()=>this.currentUserSubject.next(this.defaultGuestUser)))}deleteAccount(){return this.http.delete(this.apiUrl,{withCredentials:!0}).pipe(t(()=>this.currentUserSubject.next(this.defaultGuestUser)))}forgotPassword(e){return this.http.post(`${this.apiUrl}/forgot-password`,e)}resetPassword(e){return this.http.post(`${this.apiUrl}/reset-password`,e)}silentRefresh(){return this.http.post(`${this.apiUrl}/refresh`,{},{withCredentials:!0})}handleSessionExpired(){this.currentUserSubject.next(this.defaultGuestUser),window.location.pathname.includes("/edit-menu")?window.location.href="/error":window.location.href="/auth"}static \u0275fac=function(r){return new(r||s)(a(n))};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
