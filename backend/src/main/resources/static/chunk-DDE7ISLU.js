import{a as H}from"./chunk-7A2L2OFH.js";import{a as G}from"./chunk-4MKGYKPC.js";import{a as q}from"./chunk-6AGFNVVN.js";import{b as z,c as R}from"./chunk-ZDOH44OJ.js";import{a as Y}from"./chunk-GYEUC36V.js";import{$ as n,Fa as C,G as k,Ga as S,I as l,K as h,L as A,Pa as U,Ra as N,U as _,Ua as O,V,W as T,Xa as P,Y as D,Z as j,_ as u,aa as o,ba as g,d as x,fa as d,fb as L,ga as p,ia as r,l as M,pa as f,qa as E,r as w,ra as $,u as y,w as m,x as c,xa as B,y as F,ya as I}from"./chunk-PKXEEY3P.js";var b=class s{constructor(t){this.http=t}apiUrl="https://localhost:8443/api/v1/users";favTeamsSubject=new x([]);favTeams$=this.favTeamsSubject.asObservable();getFavTeams(){this.http.get(`${this.apiUrl}/favorites/teams`,{withCredentials:!0}).subscribe({next:t=>this.favTeamsSubject.next(t)})}getSelectedFavTeams(){return this.favTeamsSubject.getValue()}addFavTeam(t){return this.http.post(`${this.apiUrl}/favorites/teams/${t.name}`,{},{withCredentials:!0})}removeFavTeam(t){return this.http.delete(`${this.apiUrl}/favorites/teams/${t.name}`,{withCredentials:!0})}static \u0275fac=function(e){return new(e||s)(y(P))};static \u0275prov=w({token:s,factory:s.\u0275fac,providedIn:"root"})};var W=(s,t)=>t.abbreviation;function X(s,t){if(s&1){let e=d();n(0,"div",3)(1,"button",8),p("click",function(){m(e);let a=r();return c(a.loadTeams())}),f(2,"Add Favorite Team"),o()()}}function Z(s,t){if(s&1){let e=d();n(0,"div",10)(1,"div",13),p("click",function(){let a=m(e).$implicit,v=r(2);return c(v.selectTeam(a.name))}),g(2,"img",14),o(),n(3,"div",15)(4,"span",16),f(5),o(),n(6,"button",17),p("click",function(){let a=m(e).$implicit,v=r(2);return c(v.openDeleteModal(a))}),F(),n(7,"svg",18),g(8,"path",19),o()()()()}if(s&2){let e=t.$implicit,i=r(2);l(),u("ngClass",i.backgroundService.getBackgroundColor(e.abbreviation)),l(),u("src",I("assets/team-logos-new/",e.league,"/",e.division,"/",e.abbreviation,".png"),k)("alt",B("",e.name," Logo")),l(3),E(e.name)}}function ee(s,t){if(s&1){let e=d();n(0,"section",4)(1,"div",9),D(2,Z,9,8,"div",10,W),C(4,"async"),o(),n(5,"div",11)(6,"button",12),p("click",function(){m(e);let a=r();return c(a.loadTeams())}),f(7,"Add Favorite Team"),o()()()}if(s&2){let e=r();l(2),j(S(4,0,e.favTeams$))}}function te(s,t){if(s&1){let e=d();n(0,"app-success-modal",20),p("continue",function(){m(e);let a=r();return c(a.showSuccessModal=!1)}),o()}if(s&2){let e=r();u("message",e.successMessage)}}function ie(s,t){if(s&1){let e=d();n(0,"app-remove-confirmation-modal",21),p("confirm",function(){m(e);let a=r();return c(a.confirmDeleteTeam())})("cancel",function(){m(e);let a=r();return c(a.cancelDeleteModal())}),o()}s&2&&u("title","Are you sure you want to remove this team as favorite?")("contentMessage","This action cannot be undone. The team will be removed from your favorites.")("buttonContent","Yes, Remove")("isDelete",!0)}var J=class s{constructor(t,e,i,a){this.userService=t;this.backgroundService=e;this.teamService=i;this.authService=a}favTeams$;username="";errorMessage="";successMessage="";showDeleteModal=!1;teamToDelete;showSuccessModal=!1;addButtonClicked=!1;availableTeams=[];visibleTeams=[];pageSize=10;currentPage=0;isClose=!1;hasMore;ngOnInit(){this.favTeams$=this.userService.favTeams$,this.userService.getFavTeams(),this.getUsername()}getUsername(){this.authService.getActiveUser().subscribe({next:t=>this.username=t.username,error:t=>this.errorMessage="Unexpected error while retrieving the user"})}updateAvailableTeams(t){this.favTeams$.pipe(M(1)).subscribe(e=>{this.availableTeams=t.filter(i=>!e.some(a=>a.name===i.name)),this.currentPage=0,this.visibleTeams=this.availableTeams.slice(0,this.pageSize),this.hasMore=this.visibleTeams.length<this.availableTeams.length})}loadTeams(){this.addButtonClicked=!0,this.errorMessage="",this.teamService.getTeamsNamesAndAbbr().subscribe({next:t=>this.updateAvailableTeams(t),error:t=>this.errorMessage="Error while loading the teams"})}addFavoriteTeam(t){let e=t;this.errorMessage="",this.successMessage="",this.userService.addFavTeam(e).subscribe({next:i=>{this.successMessage="Team successfully added",this.showSuccessModal=!0,this.userService.getFavTeams(),this.teamService.getTeamsNamesAndAbbr().subscribe(a=>{this.updateAvailableTeams(a)})},error:i=>this.errorMessage=i.message})}closeTeamModal=()=>{this.isClose=!0,setTimeout(()=>{this.addButtonClicked=!1,this.isClose=!1},300)};openDeleteModal(t){this.showDeleteModal=!0,this.teamToDelete=t}cancelDeleteModal(){this.showDeleteModal=!1}confirmDeleteTeam(){this.errorMessage="",this.successMessage="",this.userService.removeFavTeam(this.teamToDelete).subscribe({next:t=>{this.showDeleteModal=!1,this.successMessage="Team successfully removed",this.showSuccessModal=!0,this.userService.getFavTeams(),this.teamService.getTeamsNamesAndAbbr().subscribe(e=>{this.updateAvailableTeams(e)})},error:t=>this.errorMessage=t.message})}selectTeam(t){this.teamService.selectTeam(t).subscribe({error:e=>this.errorMessage=e.message})}loadMoreTeams(){this.currentPage++;let t=this.currentPage*this.pageSize,e=t+this.pageSize;this.visibleTeams=[...this.visibleTeams,...this.availableTeams.slice(t,e)],this.hasMore=this.visibleTeams.length<this.availableTeams.length}loadMoreTeamsCondition(){return this.hasMore=this.visibleTeams.length<this.availableTeams.length,this.hasMore}static \u0275fac=function(e){return new(e||s)(h(b),h(R),h(z),h(H))};static \u0275cmp=A({type:s,selectors:[["app-fav-team"]],decls:10,vars:12,consts:[[1,"app-background","min-h-screen","text-gray-900","dark:text-white","px-6","py-16","space-y-24","flex","flex-col","items-center"],[1,"w-full","flex","justify-center","text-center","overflow-visible"],[1,"app-page-titles"],[1,"flex","justify-center"],[1,"w-full","max-w-6xl","team-section-container"],[3,"select","loadNextPageFunction","closeModal","teamElements","openModal","isClose","hasMore","elements","appEscapeClose"],[3,"message"],[3,"title","contentMessage","buttonContent","isDelete"],[1,"px-6","py-3","app-button","hover:scale-105",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","lg:grid-cols-6","gap-x-14","gap-y-16","justify-center"],[1,"flex","flex-col","items-center","space-y-3","relative","text-center"],[1,"mt-12","flex","justify-center"],[1,"px-6","py-3","app-button",3,"click"],["id","team-container",1,"w-32","h-32","rounded-full","shadow-lg","flex","items-center","justify-center","cursor-pointer",3,"click","ngClass"],[1,"w-24","h-24","object-contain","cursor-pointer","hover:animate-scale",3,"src","alt"],[1,"flex","items-center","justify-center","gap-2"],[1,"text-lg","font-semibold","text-center"],["title","Remove team",1,"text-red-500","hover:text-red-700","transition","cursor-pointer",3,"click"],["fill","currentColor","viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5"],["fill-rule","evenodd","d","M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule","evenodd"],[3,"continue","message"],[3,"confirm","cancel","title","contentMessage","buttonContent","isDelete"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"section",1)(2,"h1",2),f(3),o()(),_(4,X,3,0,"div",3),C(5,"async"),V(6,ee,8,2,"section",4),n(7,"app-select-element-modal",5),p("select",function(v){return i.addFavoriteTeam(v)})("loadNextPageFunction",function(){return i.loadMoreTeams()})("closeModal",function(){return i.closeTeamModal()}),o(),_(8,te,1,1,"app-success-modal",6),_(9,ie,1,4,"app-remove-confirmation-modal",7),o()),e&2){let a;l(3),$(" ",i.username,"'s Favorite Teams "),l(),T(((a=S(5,10,i.favTeams$))==null?null:a.length)===0?4:6),l(3),u("teamElements",!0)("openModal",i.addButtonClicked)("isClose",i.isClose)("hasMore",i.hasMore)("elements",i.visibleTeams)("appEscapeClose",i.closeTeamModal),l(),T(i.showSuccessModal?8:-1),l(),T(i.showDeleteModal?9:-1)}},dependencies:[O,U,G,Y,q,L,N],encapsulation:2})};export{J as FavTeamComponent};
