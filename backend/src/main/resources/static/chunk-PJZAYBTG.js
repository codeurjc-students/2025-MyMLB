import{a as Y,b as H}from"./chunk-UI7KFSXJ.js";import{a as K}from"./chunk-P6FBTWPZ.js";import{a as z}from"./chunk-QHRVWTMD.js";import{a as J}from"./chunk-E4CUHPIT.js";import{a as W,c as j,e as N,q as F}from"./chunk-EVNGVB2L.js";import{a as G}from"./chunk-6DCJJQNU.js";import{$ as n,G as T,I as u,L as b,P as A,U as h,Ua as L,W as _,_ as d,aa as r,ba as C,bb as O,ca as P,da as D,ea as R,fa as v,ga as m,ha as q,ia as f,m as V,ma as y,pa as p,qa as U,ra as B,ta as M,ua as S,v as w,va as E,w as s,x as c,y as I,z as k}from"./chunk-RUM4B2H2.js";var x=class o{content;confirm=new A;handleConfirm(){this.confirm.emit()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-profile-buttons"]],inputs:{content:"content"},outputs:{confirm:"confirm"},decls:4,vars:1,consts:[[1,"relative","inline-flex","items-center","justify-center","px-6","py-3","overflow-hidden","font-medium","text-white","cursor-pointer","transition-all","duration-300","bg-gradient-to-r","from-red-500","to-rose-600","rounded-xl","shadow-lg","group","hover:from-red-600","hover:to-rose-700","hover:scale-105",3,"click"],[1,"absolute","inset-0","transition-transform","duration-300","ease-out","translate-x-full","bg-white","opacity-10","group-hover:translate-x-0"],[1,"relative","z-10","text-lg","tracking-wide"]],template:function(e,t){e&1&&(P(0,"button",0),q("click",function(){return t.handleConfirm()}),R(1,"span",1),P(2,"span",2),p(3),D()()),e&2&&(u(3),U(t.content))},encapsulation:2})};function $(o,i){if(o&1){let e=v();n(0,"app-remove-confirmation-modal",25),m("confirm",function(){s(e);let l=f();return c(l.confirm())})("cancel",function(){s(e);let l=f();return c(l.cancel())}),r()}if(o&2){let e=f();d("title",e.activeAction==="logout"?"Are you sure you want to log out?":"Are you sure you want to delete your account?")("contentMessage",e.activeAction==="logout"?"You will be signed out of your account and will need to log in again to continue.":"Your account will be deleted from the system and this is an irreversible change.")("buttonContent",e.activeAction==="logout"?"Yes, Logout":"Yes, Delete")("isDelete",e.activeAction==="delete")}}function ee(o,i){if(o&1){let e=v();n(0,"app-success-modal",26),m("continue",function(){s(e);let l=f();return c(l.sucess=!1)}),r()}if(o&2){let e=f();d("message",e.successMessage)}}function te(o,i){if(o&1){let e=v();n(0,"app-error-modal",27),m("cancel",function(){s(e);let l=f();return c(l.error=!1)}),r()}if(o&2){let e=f();d("title",e.errorMessage)}}function ie(o,i){o&1&&C(0,"app-loading-modal",23),o&2&&d("message","Uploading the image...")}var Q=class o{authService=w(Y);router=w(O);userService=w(H);username="";error=!1;errorMessage="";activeAction=null;editRequest={};pictureSrc=null;emailInput="";passwordInput="";currentEmail="";oldEmail="";sucess=!1;successMessage="";loading=!1;ngOnInit(){this.authService.getActiveUser().subscribe({next:i=>{this.username=i.username},error:()=>{this.error=!0,this.errorMessage="Unexpected error while retrieving the user"}}),this.retrieveProfileData()}retrieveProfileData(){this.userService.getUserProfile().subscribe({next:i=>{this.currentEmail=i.email,this.oldEmail=i.email,this.pictureSrc=i.picture},error:i=>{this.error=!0,this.errorMessage="Unexpected error while retrieving the profile data"}})}openModal(i){this.activeAction=i}cancel(){this.activeAction=null}confirm(){this.activeAction==="logout"&&this.authService.logoutUser().subscribe(()=>this.router.navigate(["/"])),this.activeAction==="delete"&&this.authService.deleteAccount().subscribe(()=>this.router.navigate(["/"])),this.activeAction=null}prepareRequest(){this.emailInput!==""&&(this.editRequest.email=this.emailInput),this.passwordInput!==""&&(this.editRequest.password=this.passwordInput)}editProfile(){this.prepareRequest(),this.userService.editProfile(this.editRequest).subscribe({next:i=>{this.sucess=!0,this.successMessage="Profile Updated!",this.currentEmail=this.editRequest.email===null||this.editRequest.email===void 0?this.oldEmail:this.editRequest.email,this.emailInput="",this.passwordInput=""},error:i=>{this.error=!0,this.errorMessage="Invalid format for some of the fields entered"}})}handleProfilePicture(i){let e=i.target;if(e.files&&e.files.length>0){let t=e.files[0];if(t.type!=="image/webp"){this.error=!0,this.errorMessage="Only .webp images are allowed",this.loading=!1;return}this.changeProfilePicture(t)}}getPictureUrl(){return this.pictureSrc===null?"assets/account-avatar.png":this.pictureSrc.url}changeProfilePicture(i){if(i.type!=="image/webp"){this.error=!0,this.errorMessage="Only .webp images are allowed";return}this.loading=!0,this.userService.editProfilePicture(i).pipe(V(()=>this.loading=!1)).subscribe({next:e=>{this.sucess=!0,this.successMessage="Picture uploaded successfully",this.pictureSrc=e,this.userService.setProfilePicture(e.url)},error:e=>{this.error=!0,this.errorMessage="An error occurred trying to upload the picture"}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-profile"]],decls:38,vars:11,consts:[["fileInput",""],[1,"min-h-screen","app-background","flex","flex-col","items-center","justify-center","gap-12","p-6"],[1,"flex","flex-col","items-center","gap-4"],[1,"relative","group"],["alt","Profile picture",1,"w-36","h-36","rounded-full","object-cover","shadow-xl","ring-4","ring-white","dark:ring-gray-700","cursor-pointer","hover:opacity-90","transition",3,"click","src"],[1,"absolute","bottom-2","right-2","bg-blue-600","hover:bg-blue-700","text-white","p-2","rounded-full","shadow-md","opacity-90","group-hover:opacity-100","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M12 12V4m0 0l-3 3m3-3l3 3"],["type","file","accept","image/webp",1,"hidden",3,"change"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"font-semibold"],[1,"text-4xl","font-bold","text-gray-900","dark:text-gray-100","tracking-tight"],[1,"bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"w-full","max-w-lg","bg-white","dark:bg-gray-800","rounded-3xl","shadow-xl","p-8","flex","flex-col","gap-8"],[1,"text-2xl","font-semibold","text-center","bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"flex","flex-col","gap-2"],[1,"text-gray-700","dark:text-gray-300","font-medium"],["type","email",1,"text-inputs",3,"ngModelChange","placeholder","ngModel"],["type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022 (new password)",1,"text-inputs",3,"ngModelChange","ngModel"],[1,"w-full","py-3","app-success-button",3,"click"],[1,"flex","flex-row","items-center","justify-center","gap-5"],[3,"confirm","content"],[3,"title","contentMessage","buttonContent","isDelete"],[3,"message"],[3,"title"],[3,"confirm","cancel","title","contentMessage","buttonContent","isDelete"],[3,"continue","message"],[3,"cancel","title"]],template:function(e,t){if(e&1){let l=v();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"img",4),m("click",function(){s(l);let a=y(8);return c(a.click())}),r(),n(4,"button",5),m("click",function(){s(l);let a=y(8);return c(a.click())}),I(),n(5,"svg",6),C(6,"path",7),r()(),k(),n(7,"input",8,0),m("change",function(a){return s(l),c(t.handleProfilePicture(a))}),r()(),n(9,"p",9),p(10," Only "),n(11,"span",10),p(12,".webp"),r(),p(13," files are allowed "),r(),n(14,"h1",11),p(15," Welcome, "),n(16,"span",12),p(17),r()()(),n(18,"div",13)(19,"h2",14),p(20," Profile Information "),r(),n(21,"div",15)(22,"label",16),p(23,"Email"),r(),n(24,"input",17),E("ngModelChange",function(a){return s(l),S(t.emailInput,a)||(t.emailInput=a),c(a)}),r()(),n(25,"div",15)(26,"label",16),p(27,"Password"),r(),n(28,"input",18),E("ngModelChange",function(a){return s(l),S(t.passwordInput,a)||(t.passwordInput=a),c(a)}),r()(),n(29,"button",19),m("click",function(){return s(l),c(t.editProfile())}),p(30," Save Changes "),r()(),n(31,"div",20)(32,"app-profile-buttons",21),m("confirm",function(){return s(l),c(t.openModal("logout"))}),r(),n(33,"app-profile-buttons",21),m("confirm",function(){return s(l),c(t.openModal("delete"))}),r()(),h(34,$,1,4,"app-remove-confirmation-modal",22),h(35,ee,1,1,"app-success-modal",23),h(36,te,1,1,"app-error-modal",24),h(37,ie,1,1,"app-loading-modal",23),r()}e&2&&(u(3),d("src",t.getPictureUrl(),T),u(14),B(" ",t.username," "),u(7),d("placeholder",t.currentEmail),M("ngModel",t.emailInput),u(4),M("ngModel",t.passwordInput),u(4),d("content","Logout"),u(),d("content","Delete Account"),u(),_(t.activeAction?34:-1),u(),_(t.sucess?35:-1),u(),_(t.error?36:-1),u(),_(t.loading?37:-1))},dependencies:[L,F,W,j,N,z,x,G,J,K],encapsulation:2})};export{Q as ProfileComponent};
