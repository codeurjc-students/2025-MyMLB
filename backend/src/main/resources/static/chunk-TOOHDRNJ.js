import{a as L}from"./chunk-NDQQTF3M.js";import{a as G}from"./chunk-4OM73XL4.js";import{a as Y}from"./chunk-MFHGG2X3.js";import{b as z,c as R}from"./chunk-CHV4XMVR.js";import{a as K}from"./chunk-NSO5BDPE.js";import{$ as n,Fa as C,G as k,Ga as S,H as A,I as l,K as h,L as V,Pa as O,Ra as H,U as _,Ua as N,V as D,W as T,Xa as P,Y as j,Z as E,_ as d,aa as o,ba as g,d as x,fa as v,ga as m,ia as r,l as M,pa as f,qa as B,r as w,ra as U,u as y,w as c,x as p,xa as $,y as F,ya as I}from"./chunk-D66FJKGB.js";var b=class s{constructor(e){this.http=e}apiUrl="https://localhost:8443/api/v1/users";favTeamsSubject=new x([]);favTeams$=this.favTeamsSubject.asObservable();getAllUsers(){return this.http.get(this.apiUrl)}getFavTeams(){this.http.get(`${this.apiUrl}/favorites/teams`,{withCredentials:!0}).subscribe({next:e=>this.favTeamsSubject.next(e)})}getSelectedFavTeams(){return this.favTeamsSubject.getValue()}addFavTeam(e){return this.http.post(`${this.apiUrl}/favorites/teams/${e.name}`,{},{withCredentials:!0})}removeFavTeam(e){return this.http.delete(`${this.apiUrl}/favorites/teams/${e.name}`,{withCredentials:!0})}static \u0275fac=function(t){return new(t||s)(y(P))};static \u0275prov=w({token:s,factory:s.\u0275fac,providedIn:"root"})};var W=(s,e)=>e.abbreviation;function X(s,e){if(s&1){let t=v();n(0,"div",3)(1,"button",8),m("click",function(){c(t);let a=r();return p(a.loadTeams())}),f(2,"Add Favorite Team"),o()()}}function Z(s,e){if(s&1){let t=v();n(0,"div",10)(1,"div",13),m("click",function(){let a=c(t).$implicit,u=r(2);return p(u.selectTeam(a.name))}),g(2,"img",14),o(),n(3,"div",15)(4,"span",16),f(5),o(),n(6,"button",17),m("click",function(){let a=c(t).$implicit,u=r(2);return p(u.openDeleteModal(a))}),F(),n(7,"svg",18),g(8,"path",19),o()()()()}if(s&2){let t=e.$implicit,i=r(2);l(),d("ngClass",i.logoBackground(t)),l(),d("src",I("assets/team-logos-new/",t.league,"/",t.division,"/",t.abbreviation,".png"),k)("alt",$("",t.name," Logo")),l(3),B(t.name)}}function ee(s,e){if(s&1){let t=v();n(0,"section",4)(1,"div",9),j(2,Z,9,8,"div",10,W),C(4,"async"),o(),n(5,"div",11)(6,"button",12),m("click",function(){c(t);let a=r();return p(a.loadTeams())}),f(7,"Add Favorite Team"),o()()()}if(s&2){let t=r();l(2),E(S(4,0,t.favTeams$))}}function te(s,e){if(s&1){let t=v();n(0,"app-success-modal",20),m("continue",function(){c(t);let a=r();return p(a.showSuccessModal=!1)}),o()}if(s&2){let t=r();d("message",t.successMessage)}}function ie(s,e){if(s&1){let t=v();n(0,"app-remove-confirmation-modal",21),m("confirm",function(){c(t);let a=r();return p(a.confirmDeleteTeam())})("cancel",function(){c(t);let a=r();return p(a.cancelDeleteModal())}),o()}s&2&&d("title","Are you sure you want to remove this team as favorite?")("contentMessage","This action cannot be undone. The team will be removed from your favorites.")("buttonContent","Yes, Remove")("isDelete",!0)}var q=class s{constructor(e,t,i,a){this.userService=e;this.backgroundService=t;this.teamService=i;this.authService=a}favTeams$;username="";errorMessage="";successMessage="";showDeleteModal=!1;teamToDelete;showSuccessModal=!1;addButtonClicked=!1;availableTeams=[];visibleTeams=[];pageSize=10;currentPage=0;isClose=!1;hasMore;ngOnInit(){this.favTeams$=this.userService.favTeams$,this.userService.getFavTeams(),this.getUsername()}getUsername(){this.authService.getActiveUser().subscribe({next:e=>this.username=e.username,error:e=>this.errorMessage="Unexpected error while retrieving the user"})}updateAvailableTeams(e){this.favTeams$.pipe(M(1)).subscribe(t=>{this.availableTeams=e.filter(i=>!t.some(a=>a.name===i.name)),this.currentPage=0,this.visibleTeams=this.availableTeams.slice(0,this.pageSize),this.hasMore=this.visibleTeams.length<this.availableTeams.length})}loadTeams(){this.addButtonClicked=!0,this.errorMessage="",this.teamService.getTeamsNamesAndAbbr().subscribe({next:e=>this.updateAvailableTeams(e),error:e=>this.errorMessage="Error while loading the teams"})}addFavoriteTeam(e){let t=e;this.errorMessage="",this.successMessage="",this.userService.addFavTeam(t).subscribe({next:i=>{this.successMessage="Team successfully added",this.showSuccessModal=!0,this.userService.getFavTeams(),this.teamService.getTeamsNamesAndAbbr().subscribe(a=>{this.updateAvailableTeams(a)})},error:i=>this.errorMessage=i.message})}closeTeamModal(){this.isClose=!0,setTimeout(()=>{this.addButtonClicked=!1,this.isClose=!1},300)}handleEscape(e){e.key==="Escape"&&this.closeTeamModal()}openDeleteModal(e){this.showDeleteModal=!0,this.teamToDelete=e}cancelDeleteModal(){this.showDeleteModal=!1}confirmDeleteTeam(){this.errorMessage="",this.successMessage="",this.userService.removeFavTeam(this.teamToDelete).subscribe({next:e=>{this.showDeleteModal=!1,this.successMessage="Team successfully removed",this.showSuccessModal=!0,this.userService.getFavTeams(),this.teamService.getTeamsNamesAndAbbr().subscribe(t=>{this.updateAvailableTeams(t)})},error:e=>this.errorMessage=e.message})}logoBackground(e){return this.backgroundService.getBackgroundColor(e.abbreviation)}selectTeam(e){this.teamService.selectTeam(e).subscribe({error:t=>this.errorMessage=t.message})}loadMoreTeams(){this.currentPage++;let e=this.currentPage*this.pageSize,t=e+this.pageSize;this.visibleTeams=[...this.visibleTeams,...this.availableTeams.slice(e,t)],this.hasMore=this.visibleTeams.length<this.availableTeams.length}loadMoreTeamsCondition(){return this.hasMore=this.visibleTeams.length<this.availableTeams.length,this.hasMore}static \u0275fac=function(t){return new(t||s)(h(b),h(R),h(z),h(L))};static \u0275cmp=V({type:s,selectors:[["app-fav-team"]],hostBindings:function(t,i){t&1&&m("keydown",function(u){return i.handleEscape(u)},A)},decls:10,vars:11,consts:[[1,"app-background","min-h-screen","text-gray-900","dark:text-white","px-6","py-16","space-y-24","flex","flex-col","items-center"],[1,"w-full","flex","justify-center","text-center","overflow-visible"],[1,"app-page-titles"],[1,"flex","justify-center"],[1,"w-full","max-w-6xl","team-section-container"],[3,"select","loadNextPageFunction","closeModal","teamElements","openModal","isClose","hasMore","elements"],[3,"message"],[3,"title","contentMessage","buttonContent","isDelete"],[1,"px-6","py-3","app-button","hover:scale-105",3,"click"],[1,"grid","grid-cols-2","md:grid-cols-4","lg:grid-cols-6","gap-x-14","gap-y-16","justify-center"],[1,"flex","flex-col","items-center","space-y-3","relative","text-center"],[1,"mt-12","flex","justify-center"],[1,"px-6","py-3","app-button",3,"click"],["id","team-container",1,"w-32","h-32","rounded-full","shadow-lg","flex","items-center","justify-center","cursor-pointer",3,"click","ngClass"],[1,"w-24","h-24","object-contain","cursor-pointer","hover:animate-scale",3,"src","alt"],[1,"flex","items-center","justify-center","gap-2"],[1,"text-lg","font-semibold","text-center"],["title","Remove team",1,"text-red-500","hover:text-red-700","transition","cursor-pointer",3,"click"],["fill","currentColor","viewBox","0 0 20 20","xmlns","http://www.w3.org/2000/svg",1,"w-5","h-5"],["fill-rule","evenodd","d","M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule","evenodd"],[3,"continue","message"],[3,"confirm","cancel","title","contentMessage","buttonContent","isDelete"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"section",1)(2,"h1",2),f(3),o()(),_(4,X,3,0,"div",3),C(5,"async"),D(6,ee,8,2,"section",4),n(7,"app-select-element-modal",5),m("select",function(u){return i.addFavoriteTeam(u)})("loadNextPageFunction",function(){return i.loadMoreTeams()})("closeModal",function(){return i.closeTeamModal()}),o(),_(8,te,1,1,"app-success-modal",6),_(9,ie,1,4,"app-remove-confirmation-modal",7),o()),t&2){let a;l(3),U(" ",i.username,"'s Favorite Teams "),l(),T(((a=S(5,9,i.favTeams$))==null?null:a.length)===0?4:6),l(3),d("teamElements",!0)("openModal",i.addButtonClicked)("isClose",i.isClose)("hasMore",i.hasMore)("elements",i.visibleTeams),l(),T(i.showSuccessModal?8:-1),l(),T(i.showDeleteModal?9:-1)}},dependencies:[N,O,G,K,Y,H],encapsulation:2})};export{q as FavTeamComponent};
