import{a as V}from"./chunk-5ZCX3DFR.js";import{a as Y}from"./chunk-7HRPLCQ4.js";import{a as W,c as $,e as z,r as A,t as G}from"./chunk-732WY32V.js";import{$a as n,$b as R,Fb as I,Ga as _,Hb as E,La as v,S,Ua as u,Wa as g,X as x,Y as f,Ya as T,Z as F,Za as M,_a as m,ab as r,bb as k,cb as y,cc as D,db as w,ec as b,fb as C,gb as l,hb as O,ib as c,mc as U,nc as q,pb as p,rb as d,tb as j,ub as P,va as a,vb as L}from"./chunk-W3BZSQCG.js";var N=class t{ticket;open=new v;static \u0275fac=function(e){return new(e||t)};static \u0275cmp=_({type:t,selectors:[["app-support-ticket-item"]],inputs:{ticket:"ticket"},outputs:{open:"open"},decls:8,vars:6,consts:[[1,"p-5","rounded-xl","bg-white","dark:bg-gray-900","shadow-md","border","border-gray-200","dark:border-gray-800","cursor-pointer","hover:shadow-lg","transition",3,"click"],[1,"text-lg","font-semibold","text-gray-800","dark:text-gray-200"],[1,"text-sm","text-gray-500","dark:text-gray-400","mt-1"],[1,"text-xs","text-gray-400","dark:text-gray-500","mt-1"]],template:function(e,o){e&1&&(y(0,"div",0),O("click",function(){return o.open.emit()}),y(1,"h3",1),p(2),w(),y(3,"p",2),p(4),w(),y(5,"p",3),p(6),I(7,"date"),w()()),e&2&&(a(2),d(" ",o.ticket.subject," "),a(2),d(" Status: ",o.ticket.status," "),a(2),d(" Created: ",E(7,3,o.ticket.creationDate,"short")," "))},dependencies:[b,D],encapsulation:2})};var X=(t,i)=>i.id;function Z(t,i){if(t&1&&(n(0,"div",4)(1,"p",17),p(2),r(),n(3,"p",18),p(4),r(),n(5,"p",19),p(6),I(7,"date"),r()()),t&2){let e=i.$implicit;a(2),d(" From: ",e.senderEmail," "),a(2),d(" ",e.body," "),a(2),d(" ",E(7,3,e.creationDate,"short")," ")}}function ee(t,i){if(t&1){let e=C();n(0,"app-success-modal",20),l("continue",function(){x(e);let s=c();return f(s.success=!1)}),r()}if(t&2){let e=c();m("message",e.successMessage)}}function te(t,i){if(t&1){let e=C();n(0,"app-error-modal",21),l("cancel",function(){x(e);let s=c();return f(s.error=!1)}),r()}if(t&2){let e=c();m("title",e.errorMessage)}}function ie(t,i){t&1&&k(0,"app-loading-modal",15),t&2&&m("message","Sending the response...")}var B=class t{supportService=S(V);ticketId;close=new v;isClosing=!1;messages=[];replyBody="";loading=!1;success=!1;error=!1;successMessage="";errorMessage="";constructor(){this.handleCancel=this.handleCancel.bind(this)}ngOnInit(){this.loadConversation()}handleCancel(){this.isClosing=!0,setTimeout(()=>{this.close.emit(),this.isClosing=!1},300)}loadConversation(){this.supportService.getConversation(this.ticketId).subscribe({next:i=>this.messages=i,error:i=>{this.error=!0,this.errorMessage="Unexpected error ocurred loading the conversation"}})}sendReply(){let i={adminEmail:"mlbportal29@gmail.com",body:this.replyBody};this.loading=!0,this.supportService.reply(this.ticketId,i).subscribe({next:e=>{this.loading=!1,this.success=!0,this.successMessage="Response Sent Correctly",this.replyBody="",this.loadConversation()},error:e=>{this.loading=!1,this.error=!0,this.errorMessage="An error occurred while sending the response."}})}closeTicket(){this.supportService.closeTicket(this.ticketId).subscribe({next:i=>this.close.emit(),error:i=>{this.error=!0,this.errorMessage="Unexpected error ocurred closing this ticket."}})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=_({type:t,selectors:[["app-support-ticket-modal"]],inputs:{ticketId:"ticketId"},outputs:{close:"close"},decls:24,vars:6,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm",3,"ngClass","appEscapeClose"],[1,"w-full","max-w-2xl","bg-white","dark:bg-gray-900","rounded-2xl","shadow-2xl","p-8","relative"],[1,"text-2xl","font-semibold","text-center","mb-6","bg-gradient-to-r","from-blue-500","via-indigo-500","to-purple-500","bg-clip-text","text-transparent"],[1,"max-h-80","overflow-y-auto","flex","flex-col","gap-4","pr-2"],[1,"p-4","rounded-xl","border","border-gray-200","dark:border-gray-800","bg-gray-50","dark:bg-gray-800"],[1,"mt-6"],["rows","4","placeholder","Write your reply...",1,"text-inputs","w-full","resize-none","placeholder-gray-300","dark:placeholder-gray-400",3,"ngModelChange","ngModel"],[1,"flex","justify-between","mt-6"],[1,"app-success-button","group",3,"click"],[1,"app-button-bright"],[1,"app-button-texts"],[1,"app-red-buttons","group",3,"click"],[1,"absolute","top-4","right-4","text-gray-400","hover:text-white","transition",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[3,"message"],[3,"title"],[1,"text-sm","text-gray-500","dark:text-gray-400"],[1,"text-gray-800","dark:text-gray-200","mt-2"],[1,"text-xs","text-gray-400","dark:text-gray-500","mt-2"],[3,"continue","message"],[3,"cancel","title"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),p(3," Support Ticket "),r(),n(4,"div",3),T(5,Z,8,6,"div",4,X),r(),n(7,"div",5)(8,"textarea",6),L("ngModelChange",function(h){return P(o.replyBody,h)||(o.replyBody=h),h}),r()(),n(9,"div",7)(10,"button",8),l("click",function(){return o.sendReply()}),k(11,"span",9),n(12,"span",10),p(13,"Send Reply"),r()(),n(14,"button",11),l("click",function(){return o.closeTicket()}),k(15,"span",9),n(16,"span",10),p(17," Close Ticket "),r()()(),n(18,"button",12),l("click",function(){return o.handleCancel()}),F(),n(19,"svg",13),k(20,"path",14),r()()(),u(21,ee,1,1,"app-success-modal",15),u(22,te,1,1,"app-error-modal",16),u(23,ie,1,1,"app-loading-modal",15),r()),e&2&&(m("ngClass",o.isClosing?"animate-fade-out-down":"animate-fade-in-up")("appEscapeClose",o.handleCancel),a(5),M(o.messages),a(3),j("ngModel",o.replyBody),a(13),g(o.success?21:-1),a(),g(o.error?22:-1),a(),g(o.loading?23:-1))},dependencies:[b,R,A,W,$,z,q,G,Y,U,D],encapsulation:2})};var oe=(t,i)=>i.id;function ne(t,i){t&1&&(n(0,"div",3),k(1,"img",7),n(2,"h2",8),p(3," No Tickets at the moment "),r(),n(4,"p",9),p(5," You're all caught up! \u{1F389} "),r()())}function re(t,i){if(t&1){let e=C();n(0,"app-support-ticket-item",10),l("open",function(){let s=x(e).$implicit,h=c();return f(h.openTicket(s.id))}),r()}if(t&2){let e=i.$implicit;m("ticket",e)}}function ae(t,i){if(t&1){let e=C();n(0,"app-support-ticket-modal",11),l("close",function(){x(e);let s=c();return f(s.closeModal())}),r()}if(t&2){let e=c();m("ticketId",e.selectedTicketId)}}var K=class t{supportService=S(V);tickets=[];selectedTicketId=null;ngOnInit(){this.loadTickets()}loadTickets(){this.supportService.getOpenTickets().subscribe({next:i=>this.tickets=i,error:i=>console.error("Failed to load tickets")})}openTicket(i){this.selectedTicketId=i}closeModal(){this.selectedTicketId=null,this.loadTickets()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=_({type:t,selectors:[["app-inbox"]],decls:9,vars:2,consts:[[1,"app-background","min-h-screen"],[1,"max-w-5xl","mx-auto","py-10","px-6"],[1,"app-page-titles","text-center","mb-10"],[1,"flex","flex-col","items-center","justify-center","text-center","mt-10"],[1,"flex","flex-col","gap-4","mt-6"],[3,"ticket"],[3,"ticketId"],["src","assets/no-tickets.png","alt","No Tickets Picture",1,"w-72","max-w-full","h-auto","mb-6","drop-shadow-md"],[1,"text-4xl","font-bold","text-gray-700","dark:text-gray-200","mb-2"],[1,"text-lg","text-gray-500","dark:text-gray-400"],[3,"open","ticket"],[3,"close","ticketId"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),p(3," Support Inbox "),r(),u(4,ne,6,0,"div",3),n(5,"div",4),T(6,re,1,1,"app-support-ticket-item",5,oe),r(),u(8,ae,1,1,"app-support-ticket-modal",6),r()()),e&2&&(a(4),g(o.tickets.length===0?4:-1),a(2),M(o.tickets),a(2),g(o.selectedTicketId!==null?8:-1))},dependencies:[b,N,B],encapsulation:2})};export{K as InboxComponent};
